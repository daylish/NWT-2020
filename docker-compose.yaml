version: '3'

services:

  nwtg2-db:
    image: postgres:latest
    hostname: nwtg2-db
    environment:
      - POSTGRES_PASSWORD=phohhairaetu
    ports:
      - 5432:5432

  nwtg2-rabbit:
    image: rabbitmq:3-management
    container_name: rabbit
    hostname: nwtg2-rabbit
    ports:
      - 5672:5672
      - 15672:15672

  nwtg2-eureka:
    build:
      context: ./eureka-service
    container_name: nwtg2-eureka
    hostname: nwtg2-eureka
    ports:
      - 8761:8761

  nwtg2-apigw:
    build:
      context: ./api-gateway
    container_name: nwtg2-apigw
    hostname: nwtg2-apigw
    ports:
      - 8087:8087
    depends_on:
      - nwtg2-db
      - nwtg2-rabbit
      - nwtg2-eureka

  nwtg2-authserver:
    build:
      context: ./authorization-server
    container_name: nwtg2-authserver
    hostname: nwtg2-authserver
    ports:
      - 8093:8093
    depends_on:
      - nwtg2-db
      - nwtg2-rabbit
      - nwtg2-eureka

  nwtg2-datams:
    build:
      context: ./data-microservice
    container_name: nwtg2-datams
    hostname: nwtg2-datams
    ports:
      - 8082:8082
    depends_on:
      - nwtg2-db
      - nwtg2-rabbit
      - nwtg2-eureka

  nwtg2-listms:
    build:
      context: ./list-microservice
    container_name: nwtg2-listms
    hostname: nwtg2-listms
    ports:
      - 8083:8083
    depends_on:
      - nwtg2-db
      - nwtg2-rabbit
      - nwtg2-eureka

  nwtg2-streamms:
    build:
      context: ./stream-microservice
    container_name: nwtg2-streamms
    hostname: nwtg2-streamms
    ports:
      - 8084:8084
    depends_on:
      - nwtg2-db
      - nwtg2-rabbit
      - nwtg2-eureka

  nwtg2-systemevents:
    build:
      context: ./system-events
    container_name: nwtg2-systemevents
    hostname: nwtg2-systemevents
    ports:
      - 8089:8089
    depends_on:
      - nwtg2-db
      - nwtg2-rabbit
      - nwtg2-eureka

  nwtg2-userms:
    build:
      context: ./user-microservice
    container_name: nwtg2-userms
    hostname: nwtg2-userms
    ports:
      - 8081:8081
    depends_on:
      - nwtg2-db
      - nwtg2-rabbit
      - nwtg2-eureka


  nwtg2-frontend:
    build:
      context: ./nwt-frontend
    container_name: nwtg2-frontend
    hostname: nwtg2-frontend
    ports:
      - 1112:80 # frontend se otvara na http://localhost:1112
    depends_on:
      - nwtg2-rabbit
      - nwtg2-apigw
      - nwtg2-authserver
      - nwtg2-datams
      - nwtg2-listms
      - nwtg2-streamms
      - nwtg2-systemevents
      - nwtg2-userms
